<script>
    const log = document.getElementById('log');
    const targetChannel = 'terrdog420'; 

    // Initialize the Twitch Client with more robust settings
    const client = new tmi.Client({
        options: { debug: true },
        connection: {
            reconnect: true,
            secure: true
        },
        channels: [ targetChannel ]
    });

    // Start the connection
    client.connect().catch(err => {
        log.innerHTML = `<div class="chat-line"><span class="message" style="color: #e74c3c;">Error: ${err}</span></div>`;
    });

    // Success Listener
    client.on('connected', (address, port) => {
        log.innerHTML = `<div class="chat-line"><span class="message" style="color: #2ecc71;">LIVE: Connected to ${targetChannel}'s chat!</span></div>`;
    });

    // Message Listener
    client.on('message', (channel, tags, message, self) => {
        const chatLine = document.createElement('div');
        chatLine.className = 'chat-line';
        
        const userColor = tags.color || '#3498db';
        const userName = tags['display-name'] || tags.username;

        chatLine.innerHTML = `
            <span class="meta" style="color: ${userColor}">${userName}:</span>
            <span class="message">${message}</span>
        `;

        log.appendChild(chatLine);

        // Keep last 20 messages for Chromebook performance
        if (log.childNodes.length > 20) {
            log.removeChild(log.firstChild);
        }
    });

    // Debug: If it takes more than 5 seconds, show a hint
    setTimeout(() => {
        if (log.innerText.includes("Connecting")) {
            log.innerHTML += `<div class="chat-line"><span class="message" style="color: #f1c40f;">Still trying... try refreshing the page.</span></div>`;
        }
    }, 5000);
</script>
